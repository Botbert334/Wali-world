<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#F5F7FB" />
  <title>Checkout â€” Wali World</title>
  <meta name="description" content="Checkout placeholder for Wali World." />

  <link rel="icon" type="image/svg+xml" href="./assets/logo.svg" />
  <link rel="apple-touch-icon" href="./assets/logo.svg" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Supabase CDN (Option B) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
  <script src="./js/supabase-config.js" defer></script>
  <script src="./js/supabase-client.js" defer></script>
</head>
<body>
  <header class="nav" role="banner">
    <div class="topbar">
      <div class="container topbar__row">
        <div>Secure checkout (demo)</div>
        <div class="topbar__right">
          <a class="topbar__link" href="./shop.html">Continue shopping</a>
          <span class="topbar__sep">â€¢</span>
          <a class="topbar__link" href="./index.html#contact">Support</a>
        </div>
      </div>
    </div>

    <div class="container nav__row">
      <button class="iconbtn nav__toggle" id="openMenu" type="button" aria-label="Open menu">â˜°</button>

      <a class="brand" href="./index.html" aria-label="Home">
        <span class="brand__mark" aria-hidden="true"><img src="./assets/logo.svg" alt="" decoding="async" /></span>
        <span class="brand__meta">
          <div class="brand__name">Wali World</div>
          <div class="brand__tag">Checkout (placeholder)</div>
        </span>
      </a>

      <form class="search" id="siteSearch" action="./shop.html" method="get" role="search" aria-label="Site search">
        <input class="search__input" name="q" id="navSearch" placeholder="Search essentials, sessions, and moreâ€¦" />
        <button class="iconbtn search__btn" type="submit" aria-label="Search">âŒ•</button>
      </form>

      <div class="nav__actions">
        <a class="navlink" href="./about.html">About</a>
        <a class="navlink" href="./faq.html">FAQ</a>
        <a class="iconbtn cartbtn" href="#" id="openCart" aria-label="Open cart">ðŸ›’
          <span class="cartcount" id="cartCount" style="display:none;">0</span>
        </a>
      </div>
    </div>

    <!-- Category pills removed -->
  </header>

  <main class="section" role="main">
    <div class="container grid grid-2">
      <div class="card">
        <div class="eyebrow">Checkout</div>
        <h2 class="h2">Shipping details</h2>
        <p class="lead">This is a demo checkout. Next step is connecting Stripe.</p>

        <form id="shipForm" style="margin-top:16px; display:grid; gap:12px;">
          <div>
            <label class="label" for="sName">Full name</label>
            <input class="input" id="sName" required placeholder="Name" />
          </div>
          <div>
            <label class="label" for="sEmail">Email</label>
            <input class="input" id="sEmail" type="email" required placeholder="you@example.com" />
          </div>
          <div>
            <label class="label" for="sAddr">Address</label>
            <input class="input" id="sAddr" required placeholder="123 Main St" />
          </div>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px;">
            <div>
              <label class="label" for="sCity">City</label>
              <input class="input" id="sCity" required placeholder="City" />
            </div>
            <div>
              <label class="label" for="sZip">ZIP</label>
              <input class="input" id="sZip" required placeholder="00000" />
            </div>
          </div>

          <button class="btn btn--primary" type="submit">Continue to payment (placeholder)</button>
          <small style="color: rgba(11,27,43,0.62);">Stripe-ready note: replace with Stripe Checkout or Payment Element.</small>
        </form>
      </div>

      <aside class="card">
        <div class="eyebrow">Order summary</div>
        <h2 class="h2">Cart</h2>
        <div id="summary"></div>
        <div style="margin-top:12px; display:flex; justify-content:space-between; font-weight:950;">
          <span>Subtotal</span>
          <span id="sub">$0.00</span>
        </div>
        <div style="margin-top:8px; color: rgba(11,27,43,0.62);">Shipping/taxes calculated at payment.</div>
      </aside>
    </div>
  </main>

  <footer class="footer" role="contentinfo" id="contact">
    <div class="container footer__grid">
      <div class="footer__brand">
        <div class="brand" style="min-width:0;">
          <span class="brand__mark" aria-hidden="true"><img src="./assets/logo.svg" alt="" loading="lazy" /></span>
          <span class="brand__meta">
            <div class="brand__name">Wali World</div>
            <div class="brand__tag">A premium community eâ€‘commerce + coaching platform.</div>
          </span>
        </div>
        <div class="footer__contact">
          <div><b>Contact</b></div>
          <div>hello@waliworld.example</div>
          <div>(000) 000-0000</div>
        </div>
      </div>

      <div class="footer__cols">
        <div>
          <div class="footer__head">Most Popular</div>
          <a class="footer__link" href="./shop.html?cat=Tees">Tees</a>
          <a class="footer__link" href="./shop.html?cat=Hoodies">Hoodies</a>
          <a class="footer__link" href="./shop.html?cat=Accessories">Accessories</a>
          <a class="footer__link" href="./shop.html?cat=Prints">Prints</a>
        </div>
        <div>
          <div class="footer__head">Customer Services</div>
          <a class="footer__link" href="./about.html">About</a>
          <a class="footer__link" href="./faq.html">FAQ</a>
          <a class="footer__link" href="#">Privacy Policy</a>
          <a class="footer__link" href="#">Terms &amp; Conditions</a>
        </div>
      </div>
    </div>

    <div class="container footer__bottom">
      <small>Â© <span id="year"></span> Wali World. All rights reserved.</small>
    </div>
  </footer>

  <div class="floating-cta" aria-label="Mobile cart button">
    <a class="btn btn--primary" href="#" id="openCart2">Open Cart</a>
  </div>

  <!-- Mobile menu -->
  <div class="mnav-backdrop" id="menuBackdrop" aria-hidden="true"></div>
  <aside class="mnav" id="mobileMenu" aria-label="Mobile menu">
    <div class="mnav__head"><b>Menu</b><button class="iconbtn" id="closeMenu" type="button" aria-label="Close menu">âœ•</button></div>
    <div class="mnav__body">
      <a href="./index.html">Home</a>
      <a href="./shop.html">Shop</a>
      <a href="./about.html">About</a>
      <a href="./faq.html">FAQ</a>
      <a href="./index.html#consultation">Book a Session</a>
    </div>
    <div class="mnav__foot">
      <a class="btn btn--primary" href="./shop.html">Shop Products</a>
      <a class="btn btn--ghost" href="./index.html#consultation">Book a Session</a>
    </div>
  </aside>

  <!-- Cart drawer -->
  <div class="drawer__backdrop" id="drawerBackdrop" aria-hidden="true"></div>
  <aside class="drawer" id="cartDrawer" aria-label="Cart drawer">
    <div class="drawer__head">
      <h3>Your cart</h3>
      <button class="btn btn--ghost btn--small" id="closeDrawer" type="button">Close</button>
    </div>
    <div class="drawer__body" id="cartItems"></div>
    <div class="drawer__foot">
      <div class="totals"><span>Subtotal</span><span id="cartSubtotal">$0.00</span></div>
      <button class="btn btn--primary" id="checkoutBtn" type="button">Checkout</button>
      <small style="color: rgba(11,27,43,0.62);">Taxes/shipping calculated at checkout (placeholder).</small>
    </div>
  </aside>

  <script>
    document.getElementById('year').textContent = String(new Date().getFullYear());
    document.getElementById('openCart2')?.addEventListener('click', (e)=>{
      e.preventDefault();
      document.getElementById('openCart')?.click();
    });

    const money = (n) => {
      try { return new Intl.NumberFormat(undefined, {style:'currency', currency:'USD'}).format(n); }
      catch { return `$${Number(n).toFixed(2)}`; }
    };

    function loadCart(){
      try{ return JSON.parse(localStorage.getItem('wali_cart_v1')||'{}'); }
      catch { return {}; }
    }

    async function boot(){
      const cart = loadCart();
      const res = await fetch('./data/products.json', {cache:'no-store'});
      const data = await res.json();
      const map = new Map((data.products||[]).map(p=>[p.id,p]));

      const wrap = document.getElementById('summary');
      let sum = 0;
      wrap.innerHTML = '';

      const ids = Object.keys(cart);
      if (!ids.length){
        wrap.innerHTML = '<div class="card" style="background: rgba(11,27,43,0.02);">Cart is empty. <a href="./shop.html" style="text-decoration:underline; text-decoration-color: rgba(31,166,198,0.5);">Go back to shop</a>.</div>';
      }

      ids.forEach(id => {
        const p = map.get(id);
        const q = Number(cart[id]||0);
        if (!p || !q) return;
        sum += p.price * q;
        const row = document.createElement('div');
        row.className = 'cartitem';
        row.innerHTML = `
          <img src="${p.image}" alt="" aria-hidden="true" />
          <div class="cartitem__meta">
            <p class="cartitem__title">${p.name}</p>
            <div class="cartitem__sub">${p.category} â€¢ ${money(p.price)} â€¢ Qty ${q}</div>
          </div>
        `;
        wrap.appendChild(row);
      });

      document.getElementById('sub').textContent = money(sum);

      document.getElementById('shipForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        alert('Payment step is a placeholder. Next: integrate Stripe.');
      });
    }

    boot().catch(console.error);
  </script>
  <script src="./js/app.js" defer></script>
</body>
</html>
